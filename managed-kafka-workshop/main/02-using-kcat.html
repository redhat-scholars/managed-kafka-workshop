<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Kcat with Kafka instances in OpenShift Streams for Apache Kafka :: Red Hat OpenShift Streams for Apache Kafka Workshop</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/managed-kafka-workshop/managed-kafka-workshop/main/02-using-kcat.html">
    <link rel="prev" href="01-getting-started.html">
    <link rel="next" href="03-connect-streams-apache-kafka.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/managed-kafka-workshop">Red Hat OpenShift Streams for Apache Kafka Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="managed-kafka-workshop" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-getting-started.html">1. Getting Started with OpenShift Streams for Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-getting-started.html#redhataccount">Create a Red Hat Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-getting-started.html#kafka">Provision a Kafka instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-getting-started.html#serviceaccount">Create a Service Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-getting-started.html#serviceaccountpermissions">Set Permissions for a Service Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-getting-started.html#topic">Create a Kafka Topic</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-using-kcat.html">2. Using kcat with Kafka instances in OpenShift Streams for Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#devsandboxaccess">Get access to the Developer Sandbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#toolsimage">Install the tools image on Developer Sandbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kcatconnect">Configuring kcat to connect to a Kafka instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kcatproduce">Producing messages in kcat</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kcatconsume">Consuming messages in kcat</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-connect-streams-apache-kafka.html">3. Connecting OpenShift Streams for Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-connect-streams-apache-kafka.html#toolsimage">Install the tools image on Developer Sandbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-connect-streams-apache-kafka.html#connectopenshiftstreams">Connect the OpenShift Streams for Apache Kafka instance to your OpenShift project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-connect-streams-apache-kafka.html#inspectkafkadetails">Inspect the Kafka connection details</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-bind-quarkus-application.html">4. Binding a Quarkus application to OpenShift Streams for Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-bind-quarkus-application.html#deployquarkusapplication">Deploying a Quarkus application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-bind-quarkus-application.html#createkafkatopic">Creating a Kafka topic for your Quarkus application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-bind-quarkus-application.html#toolsimage">Install the tools image on Developer Sandbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-bind-quarkus-application.html#bindquarkusapp">Binding your Quarkus application to Streams for Apache Kafka</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat OpenShift Streams for Apache Kafka Workshop</a></li>
    <li><a href="02-using-kcat.html">2. Using kcat with Kafka instances in OpenShift Streams for Apache Kafka</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/managed-kafka-workshop/edit/main/documentation/modules/ROOT/pages/02-using-kcat.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Using Kcat with Kafka instances in OpenShift Streams for Apache Kafka</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As a developer of applications and services, you can use <a href="https://github.com/edenhill/kcat">kcat</a> to test and debug your Kafka instances in OpenShift Streams for Apache Kafka. Kcat is a command-line utility for messaging in Apache Kafka 0.8 and later. With kcat, you can produce and consume messages for your Kafka instances directly from the command line, and list topic and partition information for your Kafka instances.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve provided kcat in an image that you can deploy in your OpenShift project on the Developer Sandbox for Red Hat OpenShift. So you don&#8217;t need to install kcat on your own machine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devsandboxaccess"><a class="anchor" href="#devsandboxaccess"></a>Get access to the Developer Sandbox</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://developers.redhat.com/developer-sandbox">Developer Sandbox for Red Hat OpenShift</a> provides you with a private OpenShift environment in a shared, multi-tenant OpenShift cluster that is pre-configured with a set of developer tools.</p>
</div>
<div class="paragraph">
<p>You can spin up and access your Developer Sandbox with your Red Hat account (the same account you used to create an OpenShift Streams for Apache Kafka instance).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a browser window, go to <a href="https://developers.redhat.com/developer-sandbox/get-started">developers.redhat.com/developer-sandbox/get-started</a>.</p>
</li>
<li>
<p>Click the <strong>Launch your Developer Sandbox for Red Hat OpenShift</strong> button.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-launch.png" alt="devsandbox launch">
</div>
</div>
</li>
<li>
<p>If required, log in in with your Red Hat account username and password.</p>
</li>
<li>
<p>If this is the first time you use the Developer Sandbox, your account needs to be set up. This includes a phone verification step to reduce the creation of fraudulent accounts. After this step it will take a couple of seconds to set up the sandbox.<br>
Click the <strong>Start using your sandbox</strong> button to launch the sandbox.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-start.png" alt="devsandbox start">
</div>
</div>
</li>
<li>
<p>Click <strong>DevSandbox</strong> to log into your sandbox.</p>
</li>
<li>
<p>You are redirected to the <em>Developer Perspective</em> of your sandbox OpenShift environment. Feel free to take or skip the <em>Get Started</em> tour.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-topology.png" alt="devsandbox topology">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="toolsimage"><a class="anchor" href="#toolsimage"></a>Install the tools image on Developer Sandbox</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install the tools image on your OpenShift sandbox, execute the following steps:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also install kcat on your local machine, or run kcat as a Docker container. For instructions refer to <a href="https://github.com/edenhill/kcat">github.com/edenhill/kcat</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you are in the <em>Developer Perspective</em> of your sandbox environment.</p>
</li>
<li>
<p>In the navigation menu on the left, click <strong>+Add</strong>.</p>
</li>
<li>
<p>Make sure that your OpenShift Project, which you can see at the top of the <strong>Add</strong> window, is set to <code>{username}-dev</code> (where <code>{username}</code> is your username in the sandbox OpenShift environment).</p>
</li>
<li>
<p>Click on the <strong>Container Images</strong> card.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-container-card.png" alt="devsandbox container card">
</div>
</div>
</li>
<li>
<p>In the <strong>Image name from external registry</strong> field, enter: <code>quay.io/rhosak/rhoas-tools</code>.</p>
</li>
<li>
<p>In the <strong>Runtime icon</strong> field, select <code>openshift</code>.</p>
</li>
<li>
<p>Leave all other fields set to their default values. You don&#8217;t need a route for this application, so under the <strong>Advanced Options</strong> you can uncheck the <strong>Create a route to the Application</strong> checkbox.<br>
Click the <strong>Create</strong> button. This will create a new OpenShift Deployment for the tools image. Pulling the container image and creating the container will take a couple of seconds.</p>
</li>
<li>
<p>You will see the deployment of the tools image in the <em>Topology</em> screen. The icon of the application should have a dark blue circle around it, indicating that the application has been deployed successfully.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-topology-1.png" alt="devsandbox topology 1">
</div>
</div>
</li>
<li>
<p>Click on the icon of the tools application. This will open a panel on the right-hand side of your screen. Click on the <strong>Resources</strong> tab. You will see the <strong>Pods</strong> of your Deployment. Currently we only have a single pod.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-topology-2.png" alt="devsandbox topology 2">
</div>
</div>
</li>
<li>
<p>Click on the link to the pod. This opens the details page of the pod.</p>
<div class="imageblock">
<div class="content">
<img src="_images/devsandbox-pod-details.png" alt="devsandbox pod details">
</div>
</div>
</li>
<li>
<p>Open the <strong>Terminal</strong> tab. This opens a terminal inside the pod. To check whether you can access the required tools execute the command <code>kafkacat -V</code> in your terminal. This should print the kcat version information.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafkacat -V</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">kafkacat - Apache Kafka producer and consumer tool
https://github.com/edenhill/kafkacat
Copyright (c) 2014-2019, Magnus Edenhill
Version 1.6.0 (JSON, Avro, Transactions, librdkafka 1.5.0 builtin.features=gzip,snappy,ssl,sasl,regex,lz4,sasl_gssapi,sasl_plain,sasl_scram,plugins,zstd,sasl_oauthbearer)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kcatconnect"><a class="anchor" href="#kcatconnect"></a>Configuring kcat to connect to a Kafka instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable kcat to access a Kafka instance, configure the connection using the bootstrap server endpoint and the credentials for your Streams for Apache Kafka service account. For kcat, you can configure connection information either by passing options to the kcat command or by using a configuration file. The example in this task sets environment variables and then passes them to the kcat command.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the command line in the terminal of the tools pod, enter the following commands to set the Kafka instance bootstrap server and client credentials as environment variables to be used by kcat or other applications. Replace the values with your own bootstrap server host and port and the client id and client secret of your service account.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export BOOTSTRAP_SERVER=&lt;bootstrap_server&gt;
export USER=&lt;client_id&gt;
export PASSWORD=&lt;client_secret&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kcatproduce"><a class="anchor" href="#kcatproduce"></a>Producing messages in kcat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use kcat to produce messages to Kafka topics in several ways, such as reading them from standard input (<code>stdin</code>) directly on the command line or from a file. This example produces messages from input on the command line.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the command line in the terminal of the tools pod, enter the following commands to start kcat in producer mode. This mode enables you to produce messages to your Kafka topic.<br>
This example uses the SASL/PLAIN authentication mechanism with the server and credential environment variables that you set previously.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Streams for Apache Kafka also supports the SASL/OAUTHBEARER mechanism for authentication, which is the recommended authentication mechanism to use. However, kcat does not yet fully support OAUTHBEARER, so this example uses SASL/PLAIN.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example produces messages to a topic in Streams for Apache Kafka named <code>my-first-kafka-topic</code>. Replace the topic name with the relevant topic as needed. The topic that you use in this command must already exist in Streams for Apache Kafka.</p>
</div>
<div class="paragraph">
<p>To start kcat in producer mode:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafkacat -t my-first-kafka-topic -b "$BOOTSTRAP_SERVER" \
  -X security.protocol=SASL_SSL -X sasl.mechanisms=PLAIN \
  -X sasl.username="$USER" \
  -X sasl.password="$PASSWORD" -P</code></pre>
</div>
</div>
</li>
<li>
<p>With kcat running in producer mode, enter messages into kcat that you want to produce to the Kafka topic.<br>
Example messages to produce to the Kafka topic:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">First message
Second message
Third message</code></pre>
</div>
</div>
</li>
<li>
<p>Close the kcat producer by entering <code>Ctrl+C</code> and pressing <strong>Enter</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kcatconsume"><a class="anchor" href="#kcatconsume"></a>Consuming messages in kcat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use kcat to consume messages from Kafka topics. This example consumes the messages that you sent previously with the producer that you created with kcat.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the command line in the terminal of the tools pod, enter the following commands to start kcat in consumer mode. This mode enables you to consume messages from your Kafka topic.<br>
This example uses the SASL/PLAIN authentication mechanism with the server and credential environment variables that you set previously.<br>
This example consumes and displays the messages from the <code>my-first-kafka-topic</code> example topic, and states that it reached the end of partition 0 in the topic.</p>
<div class="paragraph">
<p>Starting kcat in consumer mode:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafkacat -t my-first-kafka-topic -b "$BOOTSTRAP_SERVER" \
  -X security.protocol=SASL_SSL -X sasl.mechanisms=PLAIN \
  -X sasl.username="$USER" \
  -X sasl.password="$PASSWORD" -C</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce the following output:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">First message
Second message
Third message
% Reached end of topic my-first-kafka-topic [0] at offset 3</code></pre>
</div>
</div>
</li>
<li>
<p>Close the kcat consumer by entering <code>Ctrl+C</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have successfully used kcat to connect to a Kafka instance on OpenShift Streams for Apache Kafka and produce and consume messages from a topic.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-getting-started.html">1. Getting Started with OpenShift Streams for Apache Kafka</a></span>
  <span class="next"><a href="03-connect-streams-apache-kafka.html">3. Connecting OpenShift Streams for Apache Kafka</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
